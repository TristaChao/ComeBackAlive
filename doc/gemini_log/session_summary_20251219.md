# 設計會議總結 - 2025年12月19日

這份文件記錄了我們關於《活著回來就好》核心遊戲體驗的深入討論，重點在於確立了遊戲的視覺風格，並圍繞此風格設計了一套完整的感官回饋系統。

---

## 1. 核心視覺風格與設計方法確立

經過討論，我們最終確立了遊戲的核心視覺風格，並以此為基礎進行後續所有設計。

*   **遊戲視角：** **2D 完全俯視視角 (Strictly Top-Down)**，風格類似經典的 16-bit RPG。
*   **美術風格：** **像素藝術 (Pixel Art)**，具有清晰的黑色輪廓線。
*   **敵人尺寸：** 確認主要敵人（如貓、狗）將採用 **多圖塊大型物件 (Multi-tile Entity)** 的設計（例如貓佔據 3x3 圖塊），以在視覺上和玩法上體現其巨大的威脅感與壓迫感。
*   **設計溝通方式：** 我們同意使用 **ASCII 藝術** 來製作「概念設計圖 (Conceptual Mockup)」，以便在沒有繪圖工具的情況下，清晰地溝通畫面佈局與物件結構。

---

## 2. 貓鼠遭遇四階段感官回饋系統

我們設計了一套清晰、有層次的系統，來處理玩家從安全到被獵殺的完整體驗。

### 階段一：安全 (Safe)

*   **狀況：** 附近沒有威脅。
*   **聽覺：** 平靜的基礎背景音樂和環境音效。
*   **視覺：** 畫面乾淨，鼠鼠動畫放鬆。
*   **場景示意圖：**
    ```
    +-----------+-----------+-----------+-----------+-----------+
    |   樹(T)   |   草地░   |   草地░   |   草地░   |  蘿蔔(R)  |
    +-----------+-----------+-----------+-----------+-----------+
    |   草地░   |   草地░   |   泥土路. |   泥土路. |   草地░   |
    +-----------+-----------+-----------+-----------+-----------+
    |  洞口[H]  |   鼠鼠(m) |   泥土路. |   草地░   |   草地░   |
    +-----------+-----------+-----------+-----------+-----------+
    ```

### 階段二：警覺 (Awareness)

*   **狀況：** 貓在附近，但仍在鏡頭外。
*   **聽覺：** 在背景音樂上疊加代表貓的「**低頻貝斯**」音軌，音量與貓的距離成反比。
*   **視覺：** 畫面邊緣，朝向貓的方位，出現一個同步脈動的「**方向指示弧線**」，清晰指示威脅來源。鼠鼠的待機動畫變為警惕姿態。
*   **場景示意圖：**
    ```
                                                             )
                                                             )
    +-----------+-----------+-----------+-----------+   )
    |   樹(T)   |   草地░   |   草地░   |   草地░   |   )  <--[方向指示弧線]
    +-----------+-----------+-----------+-----------+   )
    |   草地░   |   草地░   |   泥土路. |   泥土路. |
    +-----------+-----------+-----------+-----------+
    |  洞口[H]  |   草地░   |   鼠鼠(m')|   泥土路. |
    +-----------+-----------+-----------+-----------+
    ```

### 階段三：好奇 (Curiosity)

*   **狀況：** 玩家製造的聲響（動靜範圍）被貓察覺，貓前來查看。
*   **聽覺：** 來自貓方向的，一聲短促、帶有疑問語氣的「**喵？**」。
*   **視覺：** 3x3 的巨大貓咪出現在畫面中，其頭部朝向聲源，並彈出「喵？」對話框。鼠鼠自動進入趴伏的潛行姿態。
*   **場景示意圖：**
    ```
    +-----------+-----------+-----------+-----------+-----------+
    |   貓 頭   |   貓 頭   |   貓 頭   |   草地░   |  蘿蔔(R)  |
    |  ( ^ w ^ )<--(喵?)     |           |           |           |
    +-----------+-----------+-----------+-----------+-----------+
    |   貓 身體 |  貓 身體  |  貓 身體  |   泥土路. |   草地░   |
    |   █████   |   █████   |   █████   |           |           |
    +-----------+-----------+-----------+-----------+-----------+
    |   草地░   |   貓 尾   |   貓 尾   |  鼠鼠(m_c)|  掉落物 * |
    |           |   ,_,/    |           |           |           |
    +-----------+-----------+-----------+-----------+-----------+
    ```

### 階段四：獵殺 (Hunting)

*   **狀況：** 玩家被貓看見，追逐開始。
*   **聽覺：**
    1.  **萬籟俱寂：** 所有貓的相關聲音（包括貝斯音軌）瞬間消失。
    2.  **尾巴的句點：** 0.5 秒後，一聲沉重的尾巴拍地聲（啪！）響起，宣告獵殺開始。
    3.  **追逐音樂：** 激烈的追逐音樂取代所有背景音。
*   **視覺：**
    *   **畫面暗角 (Vignette)：** 畫面四周變暗，聚焦中心。
    *   **瞳孔日蝕：** 貓眼部的像素圖切換為純黑的兇惡樣式。
    *   **攻擊提示：** 貓身旁迸發出像素化的「!」符號，代表「尾巴的句點」的視覺回饋。
    *   貓和鼠鼠都進入奔跑動畫。

---

## 3. 「強忍的驚叫」QTE 躲藏挑戰

*   **情境：** 玩家成功躲藏後，貓在藏身處附近徘徊或嗅探時觸發。
*   **機制：** 一個要求精準時機的快速反應事件 (QTE)。
*   **UI 呈現：**
    1.  畫面中央出現一個像素化的目標**按鍵圖示**（如 "E"）。
    2.  一個「**計時框**」從外圍快速向按鍵圖示收縮。
    3.  玩家需在兩者完美重疊時按下按鍵。
    4.  **動態難度：** 威脅越高（貓在嗅探 vs 只是路過），計時框收縮速度越快。
*   **結果：**
    *   **成功：** 貓失去興趣並離開。玩家聽到鬆了口氣的音效。
    *   **失敗：** 鼠鼠發出「吱！」的驚叫聲，位置暴露，貓會立刻攻擊藏身處，強制進入「獵殺」階段。
*   **介面示意圖：**
    ```
    // QTE 挑戰開始
           ╔═══════════╗      <-- 計時框 (從外向內收縮)
           ║           ║
           ║   ╔═══╗   ║
           ║   ║ E ║   ║      <-- 按鍵圖示
           ║   ╚═══╝   ║
           ║           ║
           ╚═══════════╝
    ```

---

## 4. 其他確認的設計

*   **技巧性料理小遊戲：**
    *   **切菜：** 參考《九日》的門鎖，設計為一組隨機的 上/下/左/右 指令輸入。
    *   **燒烤：** 參考《魔物獵人》的烤肉，設計為在特定音樂/聲音提示的節點按下按鈕。

---

## 5. 文件路徑更新記錄

根據使用者於 2025/12/19 重新整理 `doc` 資料夾後的結構，更新相關設計與紀錄文件的路徑如下：

*   **主要專案企劃案:** `doc/design/ComeBackAlive_Proposal.md`
*   **Roguelike 玩法設計:** `doc/design/roguelike_design_brainstorm.md`
*   **食譜核心設計:** `doc/design/recipes_design.md`
*   **食譜詳細步驟:** `doc/design/recipes_design_detail.md`
*   **倉庫系統設計:** `doc/design/warehouse_system_design.md`
*   **滑鼠窩 Demo 企劃:** `doc/design/mouse_home_demo_plan.md`
*   **會議紀錄:**
    *   `doc/gemini_log/session_summary_20251218.md`
    *   `doc/gemini_log/session_summary_20251219.md`
*   **開發日誌:** `doc/working_log/working_log_20251217.md`

---

## 6. 持久化協作流程確立 (The "Gemini Workflow")

為解決重啟後上下文丟失的問題，我們確立了一套標準化的「開機/關機」協作模式。

*   **核心檔案:** 根目錄下的 `GEMINI.md` 是此流程的核心，它包含了專案的摘要和優先閱讀文件列表。

*   **開機指令 (每日開始):**
    *   使用者下達指令：`「請閱讀 GEMINI.md」`
    *   我將會遵循該檔案的指示，讀取核心摘要和優先文件，以快速同步專案狀態。

*   **關機指令 (每日結束):**
    *   使用者下達指令：`「請總結今天的工作，並更新 GEMINI.md」`
    *   我將會執行「存檔程序」：
        1.  將當日的討論成果整理並更新到對應日期的 `session_summary_YYYYMMDD.md` 檔案中。
        2.  檢查並確保 `GEMINI.md` 的「優先閱讀文件列表」指向最新的總結檔案。
        3.  向使用者回報完成，即可安全關閉。

---

## 7. 原型實作與除錯日誌 (Prototype Implementation & Debugging Log)

本日下午，我們共同進行了第一個外部場景「庭院角落」(`GardenCorner.tscn`) 的原型實作與測試。這個過程充滿挑戰，但也讓我們對專案的理解和協作方式更加深入。

### 7.1 「庭院角落」原型實作流程

我們按照以下步驟，從零開始搭建了可互動的場景：
1.  **文件化設計：** 創建了 `doc/design/map_design_concepts.md`，將 ASCII 地圖設計範例記錄下來。
2.  **場景創建：** 建立了 `GardenCorner.tscn`，並加入了 `TileMap` 節點。
3.  **地圖繪製：** 利用現有的 `grass.png` 和 `plains.png` 圖塊，繪製了場景的基本佈局。
4.  **物件與玩家放置：**
    *   將 `Player` 節點加入場景。
    *   創建了 `StaticBody2D` 作為樹、灌木、石頭等掩體。
    *   創建了 `Area2D` 作為返回鼠窩的 `MouseHole`。
5.  **資源系統建立：**
    *   創建了可重複使用的 `Resource.tscn` 場景及其腳本 `Resource.gd`。
    *   在 `ItemDatabase.gd` 中新增了「胡蘿蔔」(`carrot`) 項目。
    *   在場景中放置了「馬鈴薯」和「胡蘿蔔」的實例。
6.  **完成循環：**
    *   創建了 `MouseHole.gd` 腳本，實現了玩家進入後返回 `mouse_nest.tscn` 的功能。

### 7.2 關鍵除錯歷程

在測試過程中，我們遭遇了一系列錯誤。以下是解決這些問題的過程：

1.  **錯誤：`The class "Resource" shadows a native class`**
    *   **原因：** 我將 `Resource.gd` 的 `class_name` 命名為了 `Resource`，與 Godot 內建的 `Resource` 類衝突。
    *   **解決方案：** 將其重命名為 `WorldResource`。

2.  **錯誤：`Node not found: "/root/MouseNest/UI/PouchScreen"`**
    *   **原因：** `Player.gd` 中寫死了只有在 `mouse_nest.tscn` 中才存在的 UI 節點路徑。
    *   **解決方案：** 在 `Player.gd` 中加入了防禦性程式碼，在獲取節點前先用 `has_node()` 檢查其是否存在，避免在 `GardenCorner.tscn` 中執行時因找不到節點而崩潰。

3.  **錯誤：`add_source: Condition "p_tile_set_source.is_null()" is true`**
    *   **原因：** 在手動建立 `TileSet` 資源時，我錯誤地將一個 `Texture2D` 直接作為 `source`，而引擎預期的是一個 `TileSetSource` 物件。
    *   **解決方案：** 為 `plains.png` 也創建一個 `TileSetAtlasSource` 子資源，確保所有 `source` 的類型都正確。

4.  **核心問題：執行 `GardenCorner.tscn` 場景時，畫面總是跳轉回 `mouse_nest.tscn`**
    *   **除錯過程：** 這是最棘手的問題。我們透過「停用全域腳本」、「更改主場景」等方式排除了專案設定和全域腳本的問題，最後使用「刪除法」一步步測試，最終鎖定問題根源在 `StaticObjects` 節點群組中的 `MouseHole` 節點。
    *   **根本原因：** 我最初將 `Player` 和 `MouseHole` 的起始位置設在了同一個座標 `(8, 8)`。這導致遊戲一啟動，物理引擎就偵測到 `Player` 和 `MouseHole` 發生重疊，立即觸發了 `body_entered` 訊號，從而執行了「返回鼠窩」的指令。
    *   **最終解決方案：** 我們首先嘗試將 `Player` 的位置移開，但問題依舊。最後的解決方案是修改 `MouseHole.gd`，將 `body_entered.connect()` 這個訊號連接的動作，**延後到場景載入後的下一幀執行** (`await get_tree().create_timer(0, false).timeout`)，徹底避免了啟動時物理引擎不穩定可能導致的訊號誤觸。

### 7.3 當前狀態

經過上述實作與除錯，`GardenCorner.tscn` 場景目前已可獨立執行並進行基本的功能測試。玩家可以在其中移動、拾取物品，並返回鼠窩。

### 7.4 測試結果與最終修正 (2025/12/19 晚間)

本日稍晚進行的測試中，再次遭遇了一些問題，但最終所有功能均已成功驗證！

**最終測試結果：**
*   **A. 移動與碰撞：** 成功。
*   **B. 採集資源 (胡蘿蔔)：** 成功。
*   **C. 採集資源 (馬鈴薯 - 挖掘)：** 成功。
*   **D. 返回鼠窩 (場景切換)：** 成功，且**物品可正確帶回鼠窩並存入頰囊**。

**關鍵除錯歷程 - 最終互動問題解決：**

儘管之前認為 `Resource.tscn` 已有 `CollisionShape2D`，但在用戶實際測試和截圖的證據下，發現 Godot 編輯器並未正確載入此部分。經過用戶手動添加 `CollisionShape2D` 後，最終問題被診斷為：`CollisionShape2D` 節點存在，但其 `shape` 屬性（即碰撞形狀資源）是空的。

*   **根本原因：** `Resource.tscn` 中的 `CollisionShape2D` 節點的 `shape` 屬性沒有正確地被指派一個 `RectangleShape2D` 資源，導致碰撞體沒有實際形狀，無法被偵測。這可能是編輯器快取、我之前替換操作的細微失誤，或是編輯器在手動操作後未正確綁定資源導致。
*   **最終解決方案：** 透過直接覆寫 `Resource.tscn`，明確地為 `CollisionShape2D` 節點的 `shape` 屬性指派 `RectangleShape2D_xyz12` 資源，確保了碰撞體的完整性。同時，為保持專案簡潔，撤銷了之前為診斷而對 `collision_layer` 和 `collision_mask` 進行的無關修改。

**設計反饋記錄：**
*   用戶提出「鼠鼠出門可能會得到祝福」以符合 Roguelike 主題。
*   用戶建議改進「回家」的使用者體驗，例如「靠近按 E 回家」或「在圈圈內待一段時間後才執行回家的動作」，而非直接掉入洞中。這些將作為未來設計迭代的重要參考。

至此，本日的所有實作與除錯任務均告完成，原型已達預期功能，並通過全面測試。
